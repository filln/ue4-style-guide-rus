
<a name="2"></a>
<a name="structure"></a>
## 2. Структура папок проекта ![#](https://img.shields.io/badge/lint-partial_support-yellow.svg)

Структура папок также должна восприниматься как закон. Она проекта так же важна, как и соглашение о наименованиях. Они тесно связаны, и нарушение правил любого из них приводит к ненужному хаосу в проекте.

Есть несколько способов организации контента UE4 проекта, но в этом гайде мы будем использовать структуру, которая основывается больше на возможности поиска и фильтрации в Content Browser — вместо того, чтобы под каждый тип материалов проекта создавать отдельную папку, будет использоваться фильтр/поиск в UE.

> Если вы используете [соглашение о наименованиях](#1.2) выше, то использование папок вроде `Meshes`, `Textures`, и `Materials` будет избыточным действием, т.к. все ассеты уже отсортированы по префиксу и могут быть отфильтрованы в content browser.

<a name="2e1"><a>
### 2e1 Пример организации папок проекта
<pre>
|-- Content
    |-- <a href="#2.2">GenericShooter</a>
        |-- Art
        |   |-- Industrial
        |   |   |-- Ambient
        |   |   |-- Machinery
        |   |   |-- Pipes
        |   |-- Nature
        |   |   |-- Ambient
        |   |   |-- Foliage
        |   |   |-- Rocks
        |   |   |-- Trees
        |   |-- Office
        |-- Characters
        |   |-- Bob
        |   |-- Common
        |   |   |-- <a href="#2.7">Animations</a>
        |   |   |-- Audio
        |   |-- Jack
        |   |-- Steve
        |   |-- <a href="#2.1.3">Zoe</a>
        |-- <a href="#2.5">Core</a>
        |   |-- Characters
        |   |-- Engine
        |   |-- <a href="#2.1.2">GameModes</a>
        |   |-- Interactables
        |   |-- Pickups
        |   |-- Weapons
        |-- Effects
        |   |-- Electrical
        |   |-- Fire
        |   |-- Weather
        |-- <a href="#2.4">Maps</a>
        |   |-- Campaign1
        |   |-- Campaign2
        |-- <a href="#2.8">MaterialLibrary</a>
        |   |-- Debug
        |   |-- Metal
        |   |-- Paint
        |   |-- Utility
        |   |-- Weathering
        |-- Placeables
        |   |-- Pickups
        |-- Weapons
            |-- Common
            |-- Pistols
            |   |-- DesertEagle
            |   |-- RocketPistol
            |-- Rifles
</pre>

Предпосылки формирования именно такой структуры проекта описаны ниже.

### Подразделы

> 2.1 [Названия папок](#structure-folder-names)

> 2.2 [Папки верхнего уровня](#structure-top-level)

> 2.3 [Папки разработчиков](#structure-developers)

> 2.4 [Карты](#structure-maps)

> 2.5 [Ядро игры](#structure-core)

> 2.6 [`Assets` и `AssetTypes`](#structure-assettypes)

> 2.7 [Большие наборы](#structure-large-sets)

> 2.8 [Библиотека материалов](#structure-material-library)


<a name="2.1"></a>
<a name="structure-folder-names"><a>
### 2.1 Названия папок ![#](https://img.shields.io/badge/lint-partial_support-yellow.svg)

Все названия папок подчиняются единому набору правил.

<a name="2.1.1"></a>
#### 2.1.1 Всегда используйте ДельфиСтиль[<sup>*</sup>](#terms-cases) ![#](https://img.shields.io/badge/lint-supported-green.svg)

ДельфиСтиль означает написание каждого слова строки с большой буквы, без пробелов и нижних пробелов. Например, `DesertEagle`, `RocketPistol`, и `ASeriesOfWords`.

См. [Использование верхнего и нижнего регистра](#terms-cases).

<a name="2.1.2"></a>
#### 2.1.2 Никогда не ставьте пробелы ![#](https://img.shields.io/badge/lint-supported-green.svg)

В дополнение к [2.1.1](#2.1.1), не используйте пробелы. Пробелы могут вызвать падения различных средств компиляции и пакетной обработки. В идеале, путь к самому проекту тоже не должен содержать пробелы и быть расположен в папке вроде `D:\Project`, а не `C:\Пользователи\Моё имя\Мои документы\Unreal Projects`.

<a name="2.1.3"></a>
#### 2.1.3 Никогда не используйте символы юникода ![#](https://img.shields.io/badge/lint-supported-green.svg)

_(Прим. пер.)_ Это также касается использования русского языка.

Если одного из ваших персонажей зовут 'Zoë', его папка должна называться `Zoe`. Символы юникода могут быть хуже [пробелов](#2.1.2) для инженерных инструментов, а некоторые инструменты UE не поддерживают символы юникода и в путях к файлам.

Если ваш проект страдает по [необъяснимым причинам](https://answers.unrealengine.com/questions/101207/undefined.html) от непонятных ошибок, а имя пользователя вашего компьютера содержит символы юникода (в т.ч. и русские буквы), то любой проект в папке `Мои документы` будет страдать аналогичным образом. Чаще всего достаточно переместить папку проекта в, скажем, `D:\Project`, и эти загадочные ошибки исчезнут.

Использование символов, отличных от `a-z`, `A-Z`, и `0-9`, напр. `@`, `-`, `_`, `,`, `*`, и `#` тоже может привести к неожиданным и трудно отслеживаемым последствиям на других платформах, в системах контроля версиями и неотшлифованных средствах разработки.

<a name="2.2"></a>
<a name="structure-top-level"><a>
### 2.2 Используйте папку верхнего уровня для всех ассетов вашего проекта ![#](https://img.shields.io/badge/lint-supported-green.svg)

Все материалы разработки вашего проекта должны располагаться в папке, названной согласно самому проекту. Например, если проект называется 'Generic Shooter', то _всё_ его содержимое должно лежать в папке `Content/GenericShooter`.

> Папка `Developers` не для материалов разработки _вашего_ проекта, и потому не относится к папке проекта. См. [2.2](#2.2) для подробного обоснования.

Есть несколько причин использования такого подхода.

<a name="2.2.1"></a>
#### 2.2.1 Отсутсвие глобальных ассетов

В стайл-гайдах по кодингу часто пишут о том, что вы не должны засорять глобальное пространство имён. Этот пункт следует этому же принципу. Если ассет существует вне проекта, велик риск роста несоблюдения структуры проекта, т.к. такой ассет становится дурным примером для других.

У каждого материала разработки должна быть своя цель, иначе он не принадлежит вашему проекту. Если ассет экспериментальный и не должен использоваться в проекте, его лучше положить в папку [`Developer`](#2.3).

<a name="2.2.2"></a>
#### 2.2.2 Уменьшение риска конфликтов при миграции

При работе над несколькими проектами команда нередко копирует ассеты из проекта в проект, если эти ассеты подходят и полезны сразу двум проектам. В таких случаях лучше произвести копию ресурсов через инструмент Migrate в Content Browser, т.к. он не только копирует сам ассет, но и все его зависимые ресурсы.

Эти зависимости легко генерируют проблемы при слиянии. Если у ваших двух проектов нет одноимённых с названием проекта папок в верхнем уровне контента, то ассеты с аналогичным названием (а то и уже адаптированные из другого проекта) могут быть уничтожены инструментом миграции.

К слову, это главная причина, по которой Epic требует такой же схемы в товарах Магазина.

После миграции, безопасное слияние ассетов может быть сделано через инструмент 'Replace References' content browser-а. После завершения миграции и слияния, лишняя папка на верхнем уровне проекта должна быть удалена. Это гарантирует _100%_ безопасность ваших миграций.

<a name="2.2.2e1"></a>
##### 2.2.2e1 Пример: главный материал

Скажем, вы сделали главный материал-шаблон в своём проекте и хотели бы использовать его в другом. Для этого вы мигрировали его. Если этот ассет не в верхней папке проекта, у него может быть название вроде `Content/MaterialLibrary/M_Master`, и, если в целевом проекте ещё нет такого главного материала, то ошибки не возникнет.

В ходе разработки проекта каждый такой главный материал дорабатывается под нужды конечного проекта.

Проблема возникает, когда, скажем, художник из одного проекта сделал симпатичный модульный набор статичных мешей, и кто-нибудь захотел включить этот набор в другой проект. Если художник — создатель набора — использовал экземпляры материала на основе главного `Content/MaterialLibrary/M_Master`, то при миграции возможна ошибка слияния с ранее мигрировавшим ассетом `Content/MaterialLibrary/M_Master`.

Эту ошибку трудно предупредить и объяснить. Человек, мигрирующий набор мешей, может быть не наслышан о разработке обоих главных материалов, и потому вовсе не осведомлён о том, что меши зависят от экземпляров материалов, которые, в свою очередь, зависят от главного материала. Но инструмент Migrate должен собрать всю сеть зависимостей с целью последующей работоспособности мигрированных ассетов, и поэтому захватит `Content/MaterialLibrary/M_Master` с исходного проекта, чем перезапишет аналогичный файл в конечном проекте.

Если эти материалы не совместимы _в принципе_, то велик риск обрушить всю библиотеку материалов вашего проекта. А ведь всё по причине отсутствия папки для проекта на верхнем уровне! Так простое перемещение мешей может наделать массу лишней работы.

<a name="2.2.3"></a>
#### 2.2.3 Примеры, шаблоны и товары с Магазина безопасны (почти)

В дополнение к [2.2.2](#2.2.2): если член команды решит добавить пример, файлы шаблона или товар с Магазина, эти ассеты гарантированно не будут пересекаться с файлами вашего проекта, т.к. у них всех есть своя папка верхнего уровня (в том случае, если имена между всеми ними и вашим проектом уникальны).

Тем не менее, нельзя на 100% доверять товарам с Магазина — не все из них следуют [правилу папки верхнего уровня](#2.2). Существует множество ассетов, где большая часть контента которых расположена в папке верхнего уровня, но при этом также используется контент из примеров движка (напр., шаблоны вроде FirstPersonShooter или Starter Content Pack). Эти ассеты из примеров могут быть изменены под нужды товара. Также, карты из этих примеров засоряют корневую папку `Content` и тоже могут пересекаться.

Если придерживаться правилу [2.2](#2.2), худшим сценарием будет использование нескольких товаров с магазина, которые зависят от одного и того же проекта-шаблона. Они могут повредить друг друга, но если именно ваши ассеты располагаются в отдельной папке ресурсов проекта, такой конфликт не затронет ваши наработки.

#### 2.2.4 DLC, подпроектами, патчами проще управлять

Если вы планируете выпустить DLC для своего проекта, или же в нём есть несколько связанных подпроектов, все ассеты этих DLC и подпроектов должны находиться в своих папках верхнего уровня. Такие подпроекты затем могут быть мигрированы из проекта или просто не участвовать в сборке. Техника создания индивидуальных папок верхнего уровня помогает с лёгкостью исключить DLC из выпечки основного проекта. Подпроекты также мигрируются с наименьшими усилиями. А если вам нужно в патче, например, заменить один материал или ввести специфичный ассет, меняющий поведение игры, но при этом вы не хотите ломать главный проект, все эти изменения тоже можно вывести в отдельную папку.

<a name="2.3"></a>
<a name="structure-developers"></a>
### 2.3 Используйте папку `Developers` для локального тестирования ![#](https://img.shields.io/badge/lint-unsupported-red.svg)

Очень часто во время разработки проекта участники команды создают, в некотором роде, "песочницу", где они проводят свои эксперименты без влияния на главный проект. Так как такая практика осуществляется на постоянной основе, члены команды могут пожелать загрузить их ассеты в систему контроля версий. Не все команды требуют использования папки `Developers`, но те, что её используют, часто испытывают одни и те же проблемы с загруженными в систему контроля версиями ассетами.

Участники команды могут по случайности начать использовать те ассеты, которые ещё не готовы к этому, а затем, при их удалении, вызывают ошибки. Например, художник может дорабатывать набор модульных статичных мешей и всё ещё корректирует их размерность и соответствие сетке. Если левел-дизайнер обнаружит такой набор в главной папке проекта, он может использовать набор во всём уровне, не зная, что этот набор позднее будет претерпевать серьёзные изменения (не исключая удаление набора). Следствием этой проблемы будет масса переделок для всей команды.

Если эти модульные меши располагаются в папке разработчиков, у левел-дизайнера не было бы причин использовать этот набор, и проблемы бы не возникло. У Content Browser есть специальная настройка в View Options, которая прячет папки разработчиков (и по умолчанию она включена), что делает случайное использование экспериментальных ресурсов невозможным.

Как только ассеты готовы, художнику достаточно переместить эти материалы разработки в соответствующую папку проекта и подфиксить редиректоры. По сути, это "продвижение" ассетов из экспериментальной зоны в продакшн.

<a name="2.4"></a>
<a name="structure-maps"></a>
### 2.4 Все уровни[<sup>*</sup>](#terms-level-map) располагаются в отдельной папке под названием Maps ![#](https://img.shields.io/badge/lint-supported-green.svg)

Файлы уровней отличаются от других, и нормальной практикой считается использование своей системы наименований, особенно, если команда работает с подуровнями или стримингом карт. Не важно, как организуются эти карты в вашем проекте — все они должны быть расположены в папке `/Content/Project/Maps`.

Возможность открыть определённую карту без необходимости объяснять, где она находится, серьёзно экономит время. Часто карты группируются в папки вроде `Maps/Campaign1/` или `Maps/Arenas`, но главное, что все они находятся в папке `/Content/Project/Maps`.

Такой подход также облегчает работу инженеров по сборке. Когда все карты в одной папке, не нужно перерывать весь проект в поиске предмета сборки/исключения из сборки. Становится труднее случайно не подготовить карту к сборке. Польза проявляется и при запуске скриптов для запекания освещения, а также в ходе процессов контроля качеством.

<a name="2.5"></a>
<a name="structure-core"></a>
### 2.5 Используйте папку `Core` ("Ядро") для особо важных блупринтов и других ассетов ![#](https://img.shields.io/badge/lint-unsupported-red.svg)

Используйте папку `/Content/Project/Core` для тех ассетов, которые являются основой разработки вашего проекта. Например, основные `GameMode`, `Character`, `PlayerController`, `GameState`, `PlayerState` и связанные блупринты должны находиться именно здесь.

Это как знак "не трогай" для других участников команды. У не-инженеров обычно нет особых причин заглядывать в эту папку. При соблюдении хорошего стиля кодинга дизайнеры смогут выполнять все изменения, касающиеся геймплея, в дочерних классах. Левел-дизайнеры должны использовать заранее приготовленные блупринты в специально отведенных папках, вместо того, чтобы всё время использовать и модифицировать базовые классы.

Например, если в вашем проекте есть пикапы, которые могут быть расположены в уровне, для них должен быть базовый класс в папке `Core/Pickups`. Такой класс будет описывать базовое поведение пикапа. Конкретные пикапы, вроде аптечки или патронов уже будут располагаться в папке `/Content/Project/Placeables/Pickups/`. Гейм-дизайнеры могут спокойно редактировать эти пикапы по своему желанию, но они не должны трогать папку `Core/Pickups`, т.к. это косвенно может повредить работоспособность всех пикапов вообще.

<a name="2.6"></a>
<a name="structure-assettypes"></a>
### 2.6 Не создавайте папки `Assets` или `AssetTypes` ![#](https://img.shields.io/badge/lint-supported-green.svg)

<a name="2.6.1"></a>
#### 2.6.1 Создание папки `Assets` является избыточным действием ![#](https://img.shields.io/badge/lint-supported-green.svg)

Все ассеты и так являются ассетами.

<a name="2.6.2"></a>
#### 2.6.2 Создание папок `Meshes`, `Textures`, или `Materials` — лишнее ![#](https://img.shields.io/badge/lint-supported-green.svg)

Все ассеты именуются с учётом их типа, и их названия уже включают указание типа в префиксе. Такие папки только добавляют избыточности в проект и легко заменяются фильтрами в Content Browser.

Для того, чтобы вывести только статичные меши в папке `Environment/Rocks/`, достаточно включить фильтр Static Mesh. Если все ассеты названы правильно, то они также будут отсортированы в алфавитном порядке, независимо от префиксов. Чтобы вывести и статичные, и скелетные меши, включите сразу два фильтра. Так вам не понадобится зажимать `Ctrl` и выделять несколько папок в проводнике Content Browser-а.

> Есть и небольшое преимущество в длине строки: префикс `S_` (статичный меш) — всего 2 символа, а папка `Meshes/` — семь.

Отсутствие таких папок устраняет ошибки с помещением статичных мешей в папку материалов.

<a name="2.7"></a>
<a name="structure-large-sets"></a>
### 2.7 Очень большие наборы ассетов получают свою собственную иерархию ![#](https://img.shields.io/badge/lint-unsupported-red.svg)

Это псевдо-исключение к правилу [2.6](#2.6).

Есть определённые виды ассетов, которые образуют большой объём связанных по смыслу файлов, но каждый такой файл обладает своей уникальной целью. Чаще всего это папки с анимациями и аудио. Мы можем добавить новый уровень иерархии в папке тогда, когда эти подуровни образуют группы в 15+ семантически связанных файлов. Не забывайте делать этим подуровням чёткие и наполненные смыслом названия.

Например, есть анимации, которые используются несколькими персонажами — они должны находиться в папке `Characters/Common/Animations` , где могут быть поддиректории `Locomotion` или `Cinematic`.

> Это правило неприменимо к ассетам вроде текстур или материалов. Это норма, когда у папки `Rocks` огромное количество текстур, соответствующее аналогичному количеству камней; при этом каждая из этих текстур относится к небольшому количеству мешей и должна быть названа соответствующим образом. Не являются исключением и текстуры в [библиотеке материалов](#2.8).

<a name="2.8"></a>
<a name="structure-material-library"></a>
### 2.8 `MaterialLibrary` (библиотека материалов) ![#](https://img.shields.io/badge/lint-unsupported-red.svg)

Если ваш проект использует главные материалы (материалы-шаблоны), слоистые материалы, или любую другую форму многократно используемых материалов и текстур, которые не принадлежат какому-нибудь подмножеству ассетов, они должны быть расположены в папке `Content/Project/MaterialLibrary`.

Так все "глобальные" материалы будут находиться в одном легкодоступном месте.

> Это также способствует политике "только экземпляры материалов" ('material instances only') в вашем проекте. Если все художники и рабочие материалы используют экземпляры материалы, то обычные материалы будут существовать только в пределах папки. Проверить соблюдение этой политики можно просто поиском основных материалов в папках, отличных от `MaterialLibrary`.

Папка `MaterialLibrary` необязательно должна состоять только из материалов. Общие текстуры-помощники, функции материалов и другие аналогичные ассеты могут храниться в этой же папке. Мы также можем объединять их в семантические группы папками. Например, общие текстуры с шумом можно объединить в папке `MaterialLibrary/Utility`.

Все материалы, предназначенные для тестирования и/или отладки должны располагаться в папке `MaterialLibrary/Debug`. Это позволяет убрать такие материалы при сборке релизной версии, а если они используются в версии для сборки, сообщение об ошибке укажет на эти связи.

**[⬆ Back to Top](#structure)**
